<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>æ—¥æœ¬ã®ç”Ÿæ´»(ä»®)</title>
<style>
  body { font-family: sans-serif; background: #FFEFD5; text-align: center; padding: 10px 5px;   
position: relative;  }
 .category-btn {
  padding: 14px 20px;
  font-size: 1.2em;
  margin: 10px auto;
  width: 92vw;
  max-width: 340px;
  background-color: orange;
  color: white;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  white-space: pre-line; /* æ”¹è¡Œè¨±å¯ */
  display: block;
  box-sizing: border-box;
  line-height: 1.4;
  text-align: center;
}
  body.darken-background {
    background-color: #2b2b2b !important;
    background-image:
    repeating-linear-gradient(45deg, rgba(255,255,255,0.015) 0, rgba(255,255,255,0.015) 1px, transparent 1px, transparent 5px),
    repeating-linear-gradient(-45deg, rgba(255,255,255,0.015) 0, rgba(255,255,255,0.015) 1px, transparent 1px, transparent 5px);
  color: white !important;
}
  .category-title {
  background-color: #00ff00;
  color: black;
  padding: 8px 16px;
  border-radius: 12px;
  display: inline-block;
  line-height: 1.3;
  white-space: pre-line; /* æ”¹è¡Œã‚’æœ‰åŠ¹ã« */
  margin-bottom: 12px;
  user-select: none;
}
  .choice {
  display: block;
  margin: 8px auto;
  padding: 14px 16px;
  padding-right: 40px; /* â† ã“ã“ã‚’è¿½åŠ  */
  font-size: 1.2em;
  max-width: 90vw;
  background-color: #ADD8E6;
  border-radius: 12px;
  position: relative;
  cursor: pointer;
  white-space: pre-wrap;
  text-align: left;
  word-break: break-word;
  box-sizing: border-box;
  text-indent: 0;
}
  .choice.disabled:hover,
  .choice.disabled:active {
    background-color: #ADD8E6 !important;
  }

  .chosen { background-color: #87b4cc; }
  .disabled { pointer-events: none; }
  .mark {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 2em;
    font-weight: bold;
    color: red;
    user-select: none;
    pointer-events: none;
  }
  .speaker-icon {
    cursor: pointer;
    font-size: 1.5em;
    color: #444;
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    user-select: none;
    pointer-events: auto;
  }
  .explanation {
    margin-top: 20px;
    white-space: pre-wrap;
    color: #444;
    text-align: left;
    max-width: 90vw;
    margin-left: auto;
    margin-right: auto;
  }
.next-btn {
  width: 100px; 
  margin: 20px auto;
  display: block;
}
#container {
  position: relative;
  padding-bottom: 80px;     /* ä¸‹ã«ã‚¹ãƒšãƒ¼ã‚¹ç¢ºä¿ */
}
body {
  position: relative;
}
  @keyframes fall {
    0% { transform: translateY(-50px) rotate(0deg); opacity: 0.8; }
    100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
  }
  .sakura {
    position: fixed;
    top: -80px;
    font-size: 24px;
    pointer-events: none;
    color: pink;
    animation: fall linear 12s;
    z-index: 9999;
    user-select: none;
  }
#header {
  display: flex !important;
  flex-direction: column !important;
  align-items: center;  /* ä¸­å¤®å¯„ã› */
  text-align: center !important;
}
#header > img#logo {
  display: block;           /* ãƒ–ãƒ­ãƒƒã‚¯è¦ç´ åŒ–ã—ã¦ä¸­å¤®å¯„ã›å¯èƒ½ã« */
  margin: 0 auto 0px;       /* ä¸Šä¸‹ãƒãƒ¼ã‚¸ãƒ³ï¼ˆä¸‹ã«5pxç©ºã‘ã‚‹ï¼‰ */
  width: 250px;             /* ãƒ­ã‚´ã®æ¨ªå¹…èª¿æ•´ */
  height: auto;             /* é«˜ã•ã¯è‡ªå‹•èª¿æ•´ */
}
#main-title {
  margin-top: 0;            /* ã‚¿ã‚¤ãƒˆãƒ«ã®ä¸Šãƒãƒ¼ã‚¸ãƒ³ã‚’è©°ã‚ã‚‹ */
  margin-bottom: 0;         /* ä¸‹ã‚‚è©°ã‚ã‚‹ */
  text-align: center;       /* ä¸­å¤®å¯„ã› */
}
</style>
</head>
<body>
<div id="header">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKgAAABLCAYAAADkm8yYAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFEmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIiB4bXA6Q3JlYXRlRGF0ZT0iMjAxOS0wNi0yNVQwMDowMTozMSswNzowMCIgeG1wOk1vZGlmeURhdGU9IjIwMTktMDctMThUMTA6MjU6NTMrMDc6MDAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMTktMDctMThUMTA6MjU6NTMrMDc6MDAiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MGZmYmQwMTUtMTM1NS00OTRh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" alt="ATP ãƒ­ã‚´"/>
<h1 id="main-title">æ—¥æœ¬ã®ç”Ÿæ´»(ä»®)</h1>
</div>
<div id="start-buttons"></div>
<div id="container"></div>

<script>
// JSONãƒ‡ãƒ¼ã‚¿ã¯ã“ã“ã«Pythonã‹ã‚‰å·®ã—è¾¼ã¿ã¾ã™
let audioPlaying = null;
const allQuestions = JSON.parse(`{questions_json}`);
const audioData = JSON.parse(`{audio_json}`);

let currentCategory = null;
let questions = [];
let currentIndex = 0;
let score = 0;
let timerInterval = null;
let answered = false;

function createButton(text, onClick) {
  const btn = document.createElement('button');
  btn.textContent = text;
  btn.className = 'category-btn';
  btn.onclick = onClick;
  return btn;
}

function showCategories() {
  document.body.classList.remove('darken-background');
  const container = document.getElementById('start-buttons');
  container.style.display = 'block';
  container.innerHTML = '';
  
  const title = document.getElementById('main-title');
  title.textContent = 'æ—¥æœ¬ã®ç”Ÿæ´»(ä»®)';
  title.classList.remove('category-title');   // â† è¿½åŠ ï¼ˆè‰²ã®ã‚¯ãƒ©ã‚¹ã‚’å¤–ã™ï¼‰
  title.style.color = '';

for (const category in allQuestions) {
  if (!category.trim()) continue; // ç©ºæ–‡å­—åˆ—ã‚’ã‚¹ã‚­ãƒƒãƒ—

  const count = allQuestions[category].length;
  const [jp, th] = category.split('\n');
  const btnText = `${jp}ï¼ˆ${count}å•ï¼‰\n${th}`;
  const btn = createButton(btnText, () => startQuiz(category));
  container.appendChild(btn);
}

  document.getElementById('container').innerHTML = '';
}

function startQuiz(category) {
  currentCategory = category;
  questions = [...allQuestions[category]].sort(() => Math.random() - 0.5);
  currentIndex = 0;
  score = 0;
  const [jp, th] = category.split('\n');
  const title = document.getElementById('main-title');
  title.innerHTML = `${jp}<br>${th}`; 
  title.classList.add('category-title');    document.getElementById('start-buttons').style.display = 'none';
  showQuestion();
}

function showQuestion() {
  answered = false;
  if (audioPlaying) {
    audioPlaying.pause();
    audioPlaying.currentTime = 0;
    audioPlaying = null;
  }
  
  answered = false;
  const q = questions[currentIndex];
  const container = document.getElementById('container');
  container.innerHTML = '';

  const progress = document.createElement('div');
  progress.textContent = `${currentIndex + 1} / ${questions.length}`;
  progress.style.fontWeight = 'bold';
  progress.style.textAlign = 'left';
  progress.style.marginBottom = '10px';
  container.appendChild(progress);

  const qElem = document.createElement('div');
  const highlighted = q.question
    .replace(/ï¼ˆæ­£ç­”\dã¤ï¼‰/g, m => `<span style="color:red;">${m}</span>`)
    .replace(/[ï¼ˆ(]à¸„à¸³à¸•à¸­à¸šà¸—à¸µà¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡\dà¸‚à¹‰à¸­[)ï¼‰]/g, m => `<span style="color:red;">${m}</span>`);
  qElem.innerHTML = highlighted;
  qElem.style.whiteSpace = 'pre-wrap';
  qElem.style.fontWeight = 'bold';
  qElem.style.fontSize = '1.2em';
  qElem.style.textAlign = 'left';
  container.appendChild(qElem);

   let selectedChoices = [];

  const shuffledChoices = [...q.choices].sort(() => Math.random() - 0.5);
 shuffledChoices.forEach(choice => {
  const choiceDiv = document.createElement('div');
    choiceDiv.className = 'choice';
    choiceDiv.textContent = choice;
    choiceDiv.style.textAlign = 'left';

    choiceDiv.onclick = () => {
      if (answered) return;  // åˆ¤å®šæ¸ˆã¿ãªã‚‰ã‚¯ãƒªãƒƒã‚¯ç„¡åŠ¹

      const alreadySelected = selectedChoices.includes(choice);

      if (alreadySelected) {
        selectedChoices = selectedChoices.filter(c => c !== choice);
        choiceDiv.classList.remove('chosen');
      } else {
        selectedChoices.push(choice);
        choiceDiv.classList.add('chosen');
      }

      if (selectedChoices.length === q.correct.length) {
        answered = true;   // æ­£èª¤åˆ¤å®šãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹
        container.classList.add('disabled');  // å¿…è¦ã«å¿œã˜ã¦

    container.querySelectorAll('.choice').forEach(choiceDiv => {
       choiceDiv.style.cursor = 'default';  // é¸æŠè‚¢ã¯ãƒã‚¤ãƒ³ã‚¿è§£é™¤
     });

     container.querySelectorAll('.speaker-icon').forEach(speaker => {
       speaker.style.cursor = 'pointer'; 
     });
        let isAllCorrect = true;

        selectedChoices.forEach(sel => {
          const choiceElement = Array.from(container.getElementsByClassName('choice'))
            .find(div => div.textContent === sel);

          if (!choiceElement) return;

          const isCorrect = q.correct.includes(sel);
          if (!isCorrect) isAllCorrect = false;

          markChoice(choiceElement, isCorrect);

    if (isCorrect) {
  const correctIndex = q.correct.indexOf(sel) + 1;
  const numberStr = String(q.number).padStart(2, '0');
  const audioFileName = `${q.categoryNo}-${numberStr}-${correctIndex}.mp3`;
  const audioSrc = audioData[audioFileName];
console.log("ğŸ”Š audioFileName:", audioFileName, "audioSrcã¯ã‚ã‚‹ï¼Ÿ", !!audioSrc);
  if (audioSrc) {
    // æ—¢å­˜ã®ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã‚’ä¸€åº¦å‰Šé™¤ï¼ˆé‡è¤‡å›é¿ï¼‰
    const existingSpeaker = choiceElement.querySelector('.speaker-icon');
    if (existingSpeaker) existingSpeaker.remove();

    const speaker = document.createElement('span');
    speaker.className = 'speaker-icon';
    speaker.innerHTML = 'ğŸ”Š';
    speaker.onclick = e => {
      e.stopPropagation();
      if (audioPlaying) {
        audioPlaying.pause();
        audioPlaying.currentTime = 0;
      }
      const audio = new Audio(audioSrc);
      audio.playbackRate = 1.3;
      audio.play();
      audioPlaying = audio;
      audio.onended = () => {
        audioPlaying = null;
      };
    };

    choiceElement.appendChild(speaker);
  } else {
    console.warn('ğŸ”Š è©²å½“éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ãªã—:', audioFileName);
  }
      }
    });

    // æ­£è§£ã ãŒæœªé¸æŠã®é¸æŠè‚¢ã«ã‚‚è‰²ã¨ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã‚’è¡¨ç¤º
    q.correct.forEach(correctAns => {
          if (!selectedChoices.includes(correctAns)) {
            const choiceElement = Array.from(container.getElementsByClassName('choice'))
              .find(div => div.textContent === correctAns);
            if (choiceElement) {
              choiceElement.style.backgroundColor = '#ffccff';
          const correctIndex = q.correct.indexOf(correctAns) + 1;
          const numberStr = String(q.number).padStart(2, '0');
          const audioFileName = `${q.categoryNo}-${numberStr}-${correctIndex}.mp3`;
          const audioSrc = audioData[audioFileName];
          if (audioSrc) {
            console.log('ğŸ”Š ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼è¿½åŠ :', audioFileName);
            const speaker = document.createElement('span');
            speaker.className = 'speaker-icon';
            speaker.innerHTML = 'ğŸ”Š';
            speaker.onclick = e => {
              e.stopPropagation();
              if (audioPlaying) {
                audioPlaying.pause();
                audioPlaying.currentTime = 0;
              }
              const audio = new Audio(audioSrc);
              audio.playbackRate = 1.3;
              audio.play();
              audioPlaying = audio;
              audio.onended = () => {
                audioPlaying = null;
              };
            };
            choiceElement.appendChild(speaker);
          }
        }
      }
    });

    // ã‚¹ã‚³ã‚¢åŠ ç®—
    if (isAllCorrect) {
      score++;
    }

    showExplanation();
  }
};


    container.appendChild(choiceDiv);
  });
}

function markChoice(choiceDiv, isCorrect) {
  const mark = document.createElement('span');
  mark.className = 'mark';
  mark.textContent = isCorrect ? 'ã€‡' : 'Ã—';
  choiceDiv.appendChild(mark);
}

function showExplanation() {
  const container = document.getElementById('container');
  const q = questions[currentIndex];

  // è§£èª¬è¡¨ç¤º
  const explanationDiv = document.createElement('div');
  explanationDiv.className = 'explanation';
  explanationDiv.textContent = q.explanation || 'è§£èª¬ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚';
  container.appendChild(explanationDiv);

  const existingNextBtn = container.querySelector('.next-btn');
  if (existingNextBtn) {
    existingNextBtn.remove();
  }
  const nextBtn = createButton('æ¬¡ã¸', () => {
    currentIndex++;
    if (currentIndex < questions.length) {
      showQuestion();
    } else {
      showResult();
    }
  });
  nextBtn.classList.add('next-btn'); 
  container.appendChild(nextBtn);

  // ã“ã“ã§ .disabled ã‚¯ãƒ©ã‚¹ã‚’å¤–ã™
  container.classList.remove('disabled');
}

function showResult() {
  let sakuraInterval; 
  document.body.classList.add('darken-background');
  const container = document.getElementById('container');
  container.innerHTML = '';

  const percent = Math.round((score / questions.length) * 100);
const resultText = document.createElement('div');
resultText.style.fontWeight = 'bold';
resultText.style.fontSize = '1.3em';
resultText.textContent = `æ­£ç­”æ•° ${score} / ${questions.length}å•ï¼ˆ${percent}%ï¼‰`;
container.appendChild(resultText);

if (percent < 50) {
  document.body.classList.add('darken-background');
} else {
  document.body.classList.remove('darken-background');
}

if (percent >= 90) {
  const createSakura = () => {
    const sakura = document.createElement('div');
    sakura.className = 'sakura';
    sakura.textContent = 'ğŸŒ¸';
    sakura.style.left = Math.random() * 100 + 'vw';
    sakura.style.animationDuration = (8 + Math.random() * 8) + 's';
    sakura.style.fontSize = (16 + Math.random() * 24) + 'px';
    document.body.appendChild(sakura);
  };

  setTimeout(() => {
    createSakura();
    sakuraInterval = setInterval(createSakura, 800);
  }, 0);
}

// ã€Œã‚‚ã†ã„ã¡ã©ã€ãƒœã‚¿ãƒ³ï¼ˆå¸¸ã«1ã¤ï¼‰
const restartBtn = createButton('ã‚‚ã†ã„ã¡ã©', () => {
  if (percent >= 90) {
    document.querySelectorAll('.sakura').forEach(el => el.remove());
    clearInterval(sakuraInterval);
  }
  showCategories();
});
restartBtn.style.width = '200px';
container.appendChild(restartBtn);
}
window.onload = function() {
  showCategories();
};
</script>

</body>
</html>
